<!-- TODO: hier "Home Page" implementieren  ("/") -->
<!-- s. Boilerplate code unten eventuell löschen -->


<div class="index-page-content">
  {% for product in collections.main-products.products %}
  <div class="index-page-product">
    <a href="{{ product.url }}">
      <div class="index-page-product__content">
        <h1> {{ product.title | upcase }} </h1>
        <div class="index-page-product__description">
          {{ product.description }}
        </div>
        <div class="index-page-product__cta">
          <div> Shop now </div>
          <div class="arrow-image-container">
            <img src="{{ 'arrow.svg' | asset_url }}" alt="arrow-image">
          </div>
        </div>
      </div>
      {% assign images = product.media | where: "media_type", "image" %}
      {% assign mainImageSrc = images[0].image.src | product_img_url: '1000x' %}
      <div class="index-page-product-image-background" data-lazy-src="{{ mainImageSrc }}">  </div>
    </a>
  </div>
{% endfor %}

</div>







<style>
  .brand-name {
    position: absolute;
    font-size: 5rem;
    top: 25vh;
    transform: translateX(calc(50vw - 50%));    /* MARK: best practice um ein position: absolute element zu centrieren? */
    /* transform-origin: 50% 100%                  https://davidwalsh.name/parallax-scroll */
  }
</style>



<!-- product scroll script -->
<script>
  const productSections = document.querySelectorAll(".index-page-product")
  const productContents = document.querySelectorAll(".index-page-product__content")

  const productSectionOptions = {
    // root: null   --> viewport (default)
    root: null,
    threshold: 0,
    rootMargin: "0px 0px 0px 0px"    // zb "-150px" -> s. wann text eingeblendet werden soll
  }


  const productSectionObserver = new IntersectionObserver(
    (entries, observer) => {
      entries.forEach((entry) => {
        // target ==  single productSection
        // target.children[0] == a tag
        // target.children[0].children[0] == content div
        // target.children[0].children[1] ==  div

        const product = entry.target
        const bgImgContainer = entry.target.children[0].children[1]   // class="index-page-product-image-background

        // lazyloading der images: https://www.youtube.com/watch?v=aUjBvuUdkhgr
        if (entry.isIntersecting) {
          console.log("is Interseting");
          preloadImage(bgImgContainer) 
          product.children[0].children[0].classList.add("product-content-show")
          // observer.unobserve(entry.target) -> wann aufrufen?!
        } 
        else if (!entry.isIntersecting) {
          // TODO: Wenn product.title mehr als eine zeile einnimmt, dann funktioniert der display fix nicht mehr wie gewollt
          product.children[0].children[0].classList.remove("product-content-show")
          // observer.unobserve(entry.target) -> wann aufrufen?!
        }
      })
    },productSectionOptions)
  


  function preloadImage(imgDiv) {
    const bgImgPath = imgDiv.dataset.lazySrc
    if (!bgImgPath) {
      // TODO: placeholder product image, mit der message, dass das original nicht laden konnte
      return 
    }
    imgDiv.style.backgroundImage = `url(${bgImgPath})`
  }


  productSections.forEach(
    (product) => {
      productSectionObserver.observe(product)
    }
  )

  



</script>




<!-- Header Scroll script -->
<script>
  // TODO: irgendwie festellen, wann target.y value mit dem vom header kolidiert bzw wann taget wieder den selben y wert hat wie ohne position absolute

  // Mit jQuery veruschen s.
  // https://stackoverflow.com/questions/15123262/positionfixed-navigation-stop-at-end-of-specific-div-parallax-scrolling-jav
  const brandName = document.querySelector(".brand-name")
  const header = document.querySelector("header")

  const controller = new ScrollMagic.Controller()
  const headerTl = new TimelineMax()
  headerTl.to(".brand-name", 1, {fontSize: 20, ease: Power0.easeNone })
  headerTl.to(".brand-name", 1, {top: 0, ease: Power0.easeNone}, 0)
  
  const headerTitleScene = new ScrollMagic.Scene({
    //triggerElement: "",      muss hier nicht definiert sein, da ja von anfang an animiert werden soll
    triggerHook: 0,
    duration: "50%"
  })
    .addTo(controller)
    .addIndicators()
    .setTween(headerTl)



</script>












<!-- {% for product in collections.main.products limit:4 %}

  <div>
    <a href="{{ product.url | within: collection }}"> {{ product.title }}</a>
    {{ product.price | money }}
    {% unless product.available %}<br><strong>sold out</strong>{% endunless %}
    <a href="{{ product.url | within: collection }}">
      <img src="{{ product.featured_image.src | img_url: 'large' }}" alt="{{ product.featured_image.alt | escape }}">
    </a>
  </div>
{% endfor %} -->

